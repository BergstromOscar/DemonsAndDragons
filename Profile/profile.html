<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-PVQPC4Q6');</script>
    <!-- End Google Tag Manager -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profile</title>
    <link rel="stylesheet" href="../style.css">
    <link id="favicon" rel="shortcut icon" type="image/png" href="../favicon.png" />
    <style>
        .container {
            display: flex;
            justify-content: space-around;
        }

        .column {
            width: 45%; /* Adjust as needed */
            background-color: rgba(47, 53, 47, 0.9);
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 8px;
            clip-path: polygon(5% 0%, 95% 0%, 100% 5%, 100% 95%, 95% 100%, 5% 100%, 0% 95%, 0% 5%); /* Eight-sided shape */
            text-align: center;
            color: white;
        }

        .group-container {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PVQPC4Q6"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header>
        <a href="../SignInSignUp/signin.html">
            <img src="../DADIcon.png" id="icon" alt="Main Icon">
        </a>
        <h1>Your Profile</h1>
        <img src="../profile-icon.png" id="profile-icon" alt="Profile Icon">
    </header>
    <main class="container">
        <div class="column">
            <div class="profile-display" id="profile-display">
                <h2>Profile Information</h2>
                <p><strong>Name:</strong> <span id="display-name"></span></p>
                <p><strong>Surname:</strong> <span id="display-surname"></span></p>
                <p><strong>Age:</strong> <span id="display-age"></span></p>
                <p><strong>Email:</strong> <span id="display-email"></span></p>
                <p><strong>Username:</strong> <span id="display-username"></span></p>
                <p><strong>Password:</strong> <span id="display-password"></span></p>
                <button id="edit-profile-button">Edit</button>
            </div>
            <form class="profile-display" id="profile-form" style="display:none;">
                <label for="name">Name:</label>
                <input type="text" id="name" name="name"><br><br>
                <label for="surname">Surname:</label>
                <input type="text" id="surname" name="surname"><br><br>
                <label for="age">Age:</label>
                <input type="number" id="age" name="age"><br><br>
                <label for="email">Email:</label>
                <input type="email" id="email" name="email"><br><br>
                <label for="username">Username:</label>
                <input type="text" id="username" name="username" readonly><br><br>
                <label for="password">Password:</label>
                <input type="password" id="password" name="password"><br><br>
                <button type="button" id="save-profile-button">Save Profile</button>
            </form>
        </div>
        <div class="column">
            <div class="group-container" id="group-container">
            
            </div>
        </div>
    </main>
    <div class="button-container">
        <button onclick="window.location.href='../index.html'">Back to Home</button>
    </div>
    <footer>
        <p>&copy; 2024 Demons And Dragons</p>
    </footer>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Updated Script Section -->
    <script>
        $(document).ready(function() {
            // Call the function after defining it
            checkSignInStatus();
            
            // Load profile data from local storage if it exists
            function loadProfileData() {
                const profileData = JSON.parse(localStorage.getItem('profileData')) || {};
                const username = localStorage.getItem('username') || '';
                const password = localStorage.getItem('password') || '';
                
                if (Object.keys(profileData).length > 0) {
                    $('#display-name').text(profileData.name || '');
                    $('#display-surname').text(profileData.surname || '');
                    $('#display-age').text(profileData.age || '');
                    $('#display-email').text(profileData.email || '');
                    $('#display-username').text(profileData.username || '');
                    $('#display-password').text('â€¢'.repeat(profileData.password.length) || ''); // Display dots for password
                    $('#profile-display').show();
                    $('#profile-form').hide();
                } else {
                    $('#profile-display').hide();
                    $('#profile-form').show();
                }
            }
    
            loadProfileData();
    
            // Save profile data to local storage
            $('#save-profile-button').click(function() {
                const profileData = {
                    name: $('#name').val(),
                    surname: $('#surname').val(),
                    age: $('#age').val(),
                    email: $('#email').val(),
                    username: $('#username').val(),
                    password: $('#password').val()
                };
                localStorage.setItem('profileData', JSON.stringify(profileData));
                alert('Profile saved successfully!');
                loadProfileData();
            });
    
            // Show the form to edit profile data
            $('#edit-profile-button').click(function() {
                const profileData = JSON.parse(localStorage.getItem('profileData')) || {};
                const username = localStorage.getItem('username') || '';
                const password = localStorage.getItem('password') || '';
                $('#name').val(profileData.name || '');
                $('#surname').val(profileData.surname || '');
                $('#age').val(profileData.age || '');
                $('#email').val(profileData.email || '');
                $('#username').val(username); // Populate username field
                $('#password').val(password); // Populate password field
                $('#profile-display').hide();
                $('#profile-form').show();
            });
    
            // Check for player group and character names
            function loadGroupContainer() {
                if (!localStorage.getItem('playerGroup')) {
                    const characters = JSON.parse(localStorage.getItem('characters')) || [];
                    let characterOptions = '';
                    characters.forEach(character => {
                        characterOptions += `<option value="${character.name}">${character.name}</option>`;
                    });
    
                    const groupContainerHtml = `
                        <label for="group-name">Group Name:</label>
                        <input type="text" id="group-name" name="group-name"><br><br>
                        <label for="character-name">Player Character Name:</label>
                        <select id="character-name" name="character-name">
                            ${characterOptions}
                        </select><br><br>
                        <button type="button" id="save-group-button">Save Group</button>
                    `;
                    $('#group-container').html(groupContainerHtml);
    
                    $('#save-group-button').click(function() {
                        const playerGroup = {
                            groupName: $('#group-name').val(),
                            characterName: $('#character-name').val()
                        };
                        localStorage.setItem('playerGroup', JSON.stringify(playerGroup));
                        alert('Group saved successfully!');
                    });
                } else {
                    $('#group-container').html('<p>Group already exists.</p>');
                }
            }
    
            loadGroupContainer();
        });
    
        // Define the checkSignInStatus function
        function checkSignInStatus() {
            if (!localStorage.getItem("signedIn")) {
                window.location.href = "../signinsignup/signin.html"; // Redirect to sign-in/sign-up page
            }
        }
    
        // Remove signedIn from localStorage when clicking the DADIcon.png
        $('#icon').click(function() {
            localStorage.removeItem("signedIn");
        });
    </script>
</body>
</html>
